let predictiveSearchOptions={resources:{type:"product,collection,page,article",limit:10},keyUpDelay:300},searchForms=document.querySelectorAll("form.search-form");for(let o of searchForms){let t=o.querySelector('input[name="q"]'),e=o.querySelector(".search-suggestions"),s=document.querySelector("#suggestion-group-template"),i=document.querySelector("#suggestion-item-template");t.addEventListener("keyup",delayAfterKeyup(async g=>{let c=await getSuggestions(g.target.value);e.innerHTML="",e.dataset.query=g.target.value;for(const[m,a]of Object.entries(c))if(a.length){let u=s.content.cloneNode(!0);u.querySelector(".suggestion-group-title").textContent=m,a.map(r=>{let n=i.content.cloneNode(!0);if(n.querySelector(".suggestion-item-url").href=r.url,n.querySelector(".suggestion-item-title").textContent=r.title,!!r.featuredImage||!!r.image){let l=n.querySelector(".suggestion-item-img img");l.src=resizeImg(r.image||r.featuredImage,"100x100"),l.alt=r.featuredImage?r.featuredImage.alt:r.title}u.querySelector(".suggestion-group-list").appendChild(n)}),e.appendChild(u)}},predictiveSearchOptions.keyUpDelay))}async function getSuggestions(o){let t=new URLSearchParams;const{resources:e}=predictiveSearchOptions;t.set("q",o),t.set("resources[type]",e.type),t.set("resources[limit]",e.limit);let s=await fetch("/search/suggest.json?"+t.toString());return!!s.ok&&(await s.json()).resources.results}function resizeImg(o,t){const[e,s,i]=o.split(/\.(png|jpg|gif)/g);return`${e}_${t}.${s}${i}`}function delayAfterKeyup(o,t){let e=0;return function(...s){clearTimeout(e),e=setTimeout(o.bind(this,...s),t||0)}}
